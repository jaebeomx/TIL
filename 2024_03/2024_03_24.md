# 2024.03.24 TIL

## ğŸ“š Axios

### ğŸš¨ Axios ì¸í„°ì…‰í„°

ì„œë²„ì— í† í° ì¸ì¦ì„ í•„ìš”ë¡œ í•˜ëŠ” API ìš”ì²­ì„ í•  ë•Œë§ˆë‹¤ HTTP Authorization ìš”ì²­ í—¤ë”ì— í† í°ì„ ë„£ì–´ì¤˜ì•¼í•˜ê³  401ì—ëŸ¬ê°€ ì„œë²„ë¡œë¶€í„° ë“¤ì–´ì˜¤ë©´ í† í°ì„ ê°±ì‹ í•´ì¤€ í›„ ì¬ìš”ì²­ì„ ë³´ë‚´ëŠ” ê³¼ì •ì„ í•œ ê³³ì—ì„œ ëª¨ë‘ ì²˜ë¦¬í•˜ì—¬ ì¤‘ë³µ ì½”ë“œë¥¼ ì œê±°í•˜ê³  ìœ ì§€ë³´ìˆ˜ì„±ì„ í–¥ìƒì‹œí‚¤ê¸° ìœ„í•´ Axios ì¸í„°ì…‰í„°ë¥¼ ì ìš©í•  ìˆ˜ ìˆë‹¤.

ì‚¬ìš©ì ì§€ì • configë¡œ ìƒˆë¡œìš´ Axios ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìƒì„±í•˜ì—¬ ì‚¬ìš©í•˜ë©´ ë”ìš± í¸ë¦¬í•˜ë‹¤(baseURL, timeout ì„¤ì •)

#### â—ï¸Axios ì¸ìŠ¤í„´ìŠ¤ ìƒì„±

```js
const instance = axios.create({
  // ìƒëŒ€ì ì¸ URLì„ ì¸ìŠ¤í„´ìŠ¤ ë©”ì„œë“œì— ì „ë‹¬í•˜ë ¤ë©´ baseURLì„ ì„¤ì •í•˜ëŠ” ê²ƒì€ í¸ë¦¬í•˜ë‹¤.
  // URL(ì„œë²„ ì£¼ì†Œ) ì˜ˆì‹œ - http://127.0.0.1:5500
  baseURL: URL,
  // ìš”ì²­ì´ timeoutë³´ë‹¤ ì˜¤ë˜ ê±¸ë¦¬ë©´ ìš”ì²­ì´ ì¤‘ë‹¨ëœë‹¤.
  timeout: 1000,
});
```

---

#### â—ï¸ìš”ì²­ ì¸í„°ì…‰í„° ì¶”ê°€í•˜ê¸°

ìš”ì²­ì´ ì „ë‹¬ë˜ê¸° ì „ì— ì‘ì—… ìˆ˜í–‰, ìš”ì²­ ì˜¤ë¥˜ê°€ ìˆëŠ” ì‘ì—… ìˆ˜í–‰ì„ í•  ìˆ˜ ìˆëŠ” 2ê°œì˜ ì½œë°± í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤.

```js
instance.interceptors.request.use(
  (config) => {
    // getToken() - í´ë¼ì´ì–¸íŠ¸ì— ì €ì¥ë˜ì–´ ìˆëŠ” ì•¡ì„¸ìŠ¤ í† í°ì„ ê°€ì ¸ì˜¤ëŠ” í•¨ìˆ˜
    const accessToken = getToken();

    config.headers["Content-Type"] = "application/json";
    config.headers["Authorization"] = `Bearer ${accessToken}`;

    return config;
  },
  (error) => {
    console.log(error);
    return Promise.reject(error);
  }
);
```

---

#### â—ï¸ì‘ë‹µ ì¸í„°ì…‰í„° ì¶”ê°€í•˜ê¸°

ì‘ë‹µ ë°ì´í„°ê°€ ìˆëŠ” ì‘ì—… ìˆ˜í–‰, ì‘ë‹µ ì˜¤ë¥˜ê°€ ìˆëŠ” ì‘ì—… ìˆ˜í–‰ì„ í•  ìˆ˜ ìˆëŠ” 2ê°œì˜ ì½œë°± í•¨ìˆ˜ë¥¼ ë°›ëŠ”ë‹¤.

```js
instance.interceptors.response.use(
  (response) => {
    if (response.status === 404) {
      console.log("404 í˜ì´ì§€ë¡œ ë„˜ì–´ê°€ì•¼ í•¨!");
    }

    return response;
  },
  async (error) => {
    if (error.response?.status === 401) {
      // isTokenExpired() - í† í° ë§Œë£Œ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ëŠ” í•¨ìˆ˜
      // tokenRefresh() - í† í°ì„ ê°±ì‹ í•´ì£¼ëŠ” í•¨ìˆ˜
      if (isTokenExpired()) await tokenRefresh();

      const accessToken = getToken();

      error.config.headers = {
        "Content-Type": "application/json",
        Authorization: `Bearer ${accessToken}`,
      };

      // ì¤‘ë‹¨ëœ ìš”ì²­ì„(ì—ëŸ¬ë‚œ ìš”ì²­)ì„ í† í° ê°±ì‹  í›„ ì¬ìš”ì²­
      const response = await axios.request(error.config);
      return response;
    }
    return Promise.reject(error);
  }
);
```

---
